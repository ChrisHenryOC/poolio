# Implementation Plan: Poolio Rearchitecture (Phases 1-4) - PREVIEW WITH ISSUE NUMBERS

> **THIS IS A TEST PREVIEW FILE**
> Generated by `/test-create-git-issues` to show how issue numbers would be transformed.
> Mock GitHub issue numbers (#1-#67) are used instead of real issue numbers.

> Generated from:
> - Requirements: docs/requirements.md
> - Architecture: docs/architecture.md
> - UI Design: docs/display-node-ui-design.md
> - Date: 2026-01-23
> - Revised: 2026-01-23 (Kent Beck principles alignment, TDD workflow, issue splitting)
> - Revised: 2026-01-23 (Architecture alignment: added ScheduleInfo/ValveState classes, message size/freshness validation, time resync, socket management, deferred captive portal)
> - Revised: 2026-01-23 (Consistency fixes: cross-references, acceptance criteria clarity, removed cooldown state)

## Overview

This implementation plan covers Phases 1-4 of the Poolio pool automation system rearchitecture:

- **Phase 1**: Foundation - Shared libraries, JSON message protocol, cloud abstraction
- **Phase 2**: Device Framework - Pool Node (C++), Valve Node (CircuitPython), Display Node (CircuitPython)
- **Phase 3**: Simulators & Testing - Node simulators, integration test suite
- **Phase 4**: Deployment - Nonprod validation, production rollout

The plan decomposes the work into 71 issues (67 MVP + 4 deferred) suitable for focused implementation sessions.

---

## Phases

| Phase | Name | Description | Issues |
|-------|------|-------------|--------|
| 1 | Foundation | Shared libraries, messages, cloud abstraction | #1-#11 |
| 2a | Pool Node | C++ sensor node with deep sleep | #12-#22 |
| 2b | Valve Node | CircuitPython fill controller | #23-#28 |
| 2c | Display Node | CircuitPython touchscreen dashboard | #29-#46 |
| 3 | Simulators | Desktop simulators and integration tests | #47-#53 |
| 4 | Deployment | Nonprod and production deployment | #54-#67 |
| 4+ | Deferred | Features to implement only if needed | (not created) |

**Note**: Phase 2a, 2b, and 2c can be worked in parallel.

---

## Issue Mapping (Plan ID → Mock GitHub #)

| Plan ID | Mock # | Title |
|---------|--------|-------|
| 1.1 | #1 | Project Setup and Structure |
| 1.2 | #2 | Message Type Classes |
| 1.3 | #3 | Message Envelope and Encoding |
| 1.4 | #4 | Message Validation (Simple) |
| 1.5 | #5 | Mock Cloud Backend for Testing |
| 1.6 | #6 | AdafruitIO HTTP Client |
| 1.7 | #7 | AdafruitIO MQTT Client and Base Class Extraction |
| 1.8 | #8 | Configuration Management |
| 1.9 | #9 | Logging Module |
| 1.10 | #10 | Sensor Utilities |
| 1.11 | #11 | Foundation Integration Test |
| 2.1 | #12 | Pool Node Project Setup |
| 2.2 | #13 | C++ Message Library |
| 2.3 | #14 | C++ Config and Logging |
| 2.4 | #15 | WiFi Manager with Timeout |
| 2.5 | #16 | Time Sync and HTTP Client |
| 2.6 | #17 | Temperature Sensor (DS18X20) |
| 2.7 | #18 | Water Level Sensor (Float Switch) |
| 2.8 | #19 | Battery Monitor (LC709203F) |
| 2.9 | #20 | Watchdog and Sleep Manager |
| 2.10 | #21 | Pool Node Controller Integration |
| 2.11 | #22 | Pool Node Hardware Testing |
| 2.12 | #23 | Valve Node Project Setup |
| 2.13 | #24 | Fill Scheduler |
| 2.14 | #25 | Safety Interlocks |
| 2.15 | #26 | Valve Controller Core |
| 2.18 | #27 | Valve Node Integration |
| 2.19 | #28 | Valve Node Hardware Testing |
| 2.20 | #29 | Display Node Project Setup |
| 2.21 | #30 | Theme and Color Constants |
| 2.22 | #31 | Base Widget Classes |
| 2.23 | #32 | Touch Handler |
| 2.23a | #33 | Display Node UI Spike |
| 2.24 | #34 | Main Dashboard Screen Layout |
| 2.25 | #35 | Pool Node Detail Screen |
| 2.26 | #36 | Valve Node Detail Screen |
| 2.27 | #37 | Settings Screen |
| 2.28 | #38 | Stale Data Indicators |
| 2.29 | #39 | Non-Production Indicator |
| 2.30 | #40 | Burn-In Prevention |
| 2.31 | #41 | Local Sensor Reading (AHTx0) |
| 2.32 | #42 | Dashboard State Management |
| 2.33 | #43 | Dashboard Controller - Message Handling |
| 2.33a | #44 | Dashboard Controller - Commands and Navigation |
| 2.34 | #45 | Display Node Integration |
| 2.35 | #46 | Display Node Hardware Testing |
| 3.1 | #47 | Simulator Common Utilities |
| 3.2 | #48 | Pool Node Simulator |
| 3.3 | #49 | Valve Node Simulator |
| 3.4 | #50 | Display Node Simulator |
| 3.5 | #51 | Integration Test Suite - Normal Flow |
| 3.6 | #52 | Integration Test Suite - Error Scenarios |
| 3.7 | #53 | Integration Test Suite - Edge Cases |
| 4.1 | #54 | Adafruit IO Feed Setup - Nonprod |
| 4.2 | #55 | Deploy Script for CircuitPython |
| 4.3 | #56 | Configuration Files - Nonprod |
| 4.4 | #57 | Pool Node Nonprod Build and Deploy |
| 4.5 | #58 | Valve Node Nonprod Deployment |
| 4.6 | #59 | Display Node Nonprod Deployment |
| 4.7 | #60 | Nonprod System Integration Test |
| 4.8 | #61 | Nonprod 1-Week Stability Test |
| 4.9 | #62 | Adafruit IO Feed Setup - Production |
| 4.10 | #63 | Configuration Files - Production |
| 4.11 | #64 | Pre-Production Checklist |
| 4.12 | #65 | Production Deployment |
| 4.13 | #66 | Production Monitoring (48 hours) |
| 4.14 | #67 | Post-Deployment Documentation |

---

## Sample Transformed Issues

### Issue #1: Project Setup and Structure

- **Phase**: 1 - Foundation
- **Type**: Setup
- **Description**: Create the project directory structure, Python package configuration, and CI/CD pipeline as defined in architecture.md Section 5.
- **Dependencies**: None

---

### Issue #2: Message Type Classes

- **Phase**: 1 - Foundation
- **Type**: Model
- **Description**: Implement plain Python classes for all message payload types defined in FR-MSG-004 through FR-MSG-013.
- **Dependencies**: #1

---

### Issue #7: AdafruitIO MQTT Client and Base Class Extraction

- **Phase**: 1 - Foundation
- **Type**: Integration
- **Description**: Implement AdafruitIOMQTT client for Valve and Display Nodes. Extract CloudBackend base class.
- **Dependencies**: #5, #6

---

### Issue #21: Pool Node Controller Integration

- **Phase**: 2a - Pool Node
- **Type**: Integration
- **Description**: Implement main PoolNode controller that orchestrates all components through the wake cycle.
- **Dependencies**: #13, #14, #15, #16, #17, #18, #19, #20

---

## Critical Path (with issue numbers)

**Phase 1**: `#1 → #2 → #3 → #4 → #11` (message protocol must be complete first)

**Phase 2**: `#29 → #30 → #31 → #32 → #34 → ... → #46` (Display Node has most issues)

**Phase 4**: `#54 → #56 → #58 → #60 → #61 → #62 → ... → #67` (sequential deployment steps)

---

## Dependency Graph (with issue numbers)

```text
Phase 1: Foundation
=========================================
[#1] ─┬─> [#2] ──> [#3] ──> [#4] ─┐
      │                            │
      ├─> [#5] ──> [#6] ──────────┤
      │        └──> [#7] ─────────┤
      │                            │
      ├─> [#8] ───────────────────┤
      │                            │
      ├─> [#9] ──> [#10] ─────────┤
      │                            │
      └───────────────────────────┴──> [#11]

Phase 2a: Pool Node
=========================================
[#12] ──> [#13] ──> [#14] ──> [#15] ──> [#16]
  │         │                             │
  └─────────┴──> [#17]                    │
  │              [#18]                    │
  │              [#19]                    │
  │                                       │
  └──> [#20] ─────────────────────────────┘
                                          │
       [#17] + [#18] + [#19] + [#20] ─────┴──> [#21] ──> [#22]

Phase 2b: Valve Node
=========================================
[#11] ──> [#23] ──> [#24] ──┐
                   [#25] ──┼──> [#26] ──> [#27] ──> [#28]

Phase 2c: Display Node
=========================================
[#11] ──> [#29] ──> [#30] ──> [#31] ──> [#32] ──> [#33] (spike)
                      │                    │           │
                      └────────────────────┴───────────┘
                                                       │
                                                    [#34]
                              │
                       ┌──────┴──────┬──────────────┐
                       ▼             ▼              ▼
                    [#35]        [#36]          [#37]
                       │             │              │
                       └─────────────┴──────────────┘
                                     │
                              ┌──────┴──────┐
                              ▼             ▼
                           [#38]        [#39]
                              │
                           [#40]
                              │
[#29] ───────────────────> [#41]
                              │
                           [#42]
                              │
                           [#43]
                              │
                          [#44] ◄───────────────────────┐
                              │                          │
                           [#45] ──> [#46]               │
                                                          │
Phase 3: Simulators                                       │
=========================================                 │
[#11] ──> [#47] ──> [#48] ─┐                            │
                   [#49] ──┼──> [#51] ──> [#52] ──> [#53]│
                   [#50] ──┘                             │

Phase 4: Deployment
=========================================
[#54] ───────────────────────────────────────────────────┘
  │
  └──> [#55] ──> [#56]
         │         │
         ├─────────┼──> [#57] ──┐
         │         │            │
         │         ├──> [#58] ──┼──> [#60] ──> [#61]
         │         │            │
         │         └──> [#59] ──┘
         │
         └──> [#62] ──> [#63] ──> [#64] ──> [#65] ──> [#66] ──> [#67]
```

---

*This preview file was generated by `/test-create-git-issues` for validation purposes.*
